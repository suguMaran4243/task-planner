        pipeline {
            agent any
            // environment {
            //     // NETLIFY_SITE_ID = '9c0ddcf5-99e7-4baa-bfdc-ef5b170037e3'
            //     // NETLIFY_AUTH_TOKEN = credentials('my-token')
            //     // NODE_EXTRA_CA_CERTS = "/etc/ssl/certs/ca-certificates.crt"
            // }

            stages {
                stage('Build') {
                    agent{
                        docker{
                        image 'node:18-alpine'
                        reuseNode true
                        }
                    }
                    steps {
                    sh '''
                        ls -la
                        node -v
                        npm -v
                        npm i
                        npm run build
                    '''
                    }
                }
                stage('AWS') {
                    agent {
                        docker {
                            image 'amazon/aws-cli'
                            args "--entrypoint=''"
                        }
                    }
                    environment{
                        AWS_S3_BUCKET = 'task-planner-4012026'
                    }
                    steps {
                        withCredentials([usernamePassword(credentialsId: 'my-aws', passwordVariable: 'AWS_SECRET_ACCESS_KEY', usernameVariable: 'AWS_ACCESS_KEY_ID')]) {
                    // some block

                        sh '''
                            aws --version
                            echo "Hello S3!" > index.html
                            aws s3 sync build s3://$AWS_S3_BUCKET
                        '''
                    }
                }
                }
                
                stage('Test')
                {
                    agent{
                        docker{
                            image 'node:18-alpine'
                            reuseNode true
                        }
                    }
                    steps{
                    sh '''
                        echo "Testing in-progess"
                        npm run test:ci
                        echo "Testing completed"
                    '''
                    }
                }
                //  stage('Deploy') {
                //     agent{
                //         docker{
                //             image 'node:18-alpine'
                //             reuseNode true
                //         }
                //     }
                //     steps {
                //        sh '''
                //             npm install netlify-cli
                //             node_modules/.bin/netlify --version
                //             echo "Deploying to production. Site ID: $NETLIFY_SITE_ID"
                //             node_modules/.bin/netlify status
                //             node_modules/.bin/netlify deploy --dir=build --prod
                //        '''
                //     }
                // }
            }
        //    post {
        //     always {
        //         junit 'coverage/junit.xml'  // must match outputName & outputDirectory
        //     }
        // }

        }
